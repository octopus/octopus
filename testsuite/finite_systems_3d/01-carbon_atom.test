# -*- coding: utf-8 mode: shell-script -*-

Test       : Carbon
Program    : octopus
TestGroups : long-run, finite_systems_3d
Enabled    : Yes

# The purpose of this test is making sure that spin-polarized
# calculations work.
# It is the calculation of one atom of Carbon, within the LSDA
# calculation.
#
# The result *almost* compares (to within 0.1eV) with the results
# given at the NIST webpage:
# http://physics.nist.gov/PhysRefData/DFTdata/contents.html
# The reasons for the discrepancy may be two:
# o The NIST calculation is all-electron.
# o The NIST calculation uses the VWN correlation. Here I have put
#   put PZ, because otherwise the results are even worse (probably
#   our VWN has some bug?)
# It would be nice to investigate the reason for the small
# discrepancy...
Input: 01-carbon_atom.01-psf_l0.inp
match ; SCF convergence ; GREPCOUNT(static/info, 'SCF converged') ; 1
Precision: 7.04e-07
match ; Total energy       ; GREPFIELD(static/info, 'Total       =', 3) ; -146.74152634
match ; Eigenvalue   [1up] ; GREPFIELD(static/info, '1   up', 3) ; -14.461741
match ; Occupation   [1up] ; GREPFIELD(static/info, '1   up', 4) ; 1.000000
match ; Eigenvalue [4down] ; GREPFIELD(static/info, '4   dn', 3) ; -3.682153
match ; Occupation [4down] ; GREPFIELD(static/info, '4   dn', 4) ; 0.000000

# Now we repeat the calculation but making use of the l=1 component
# of the pseudopotential to build the local component.
Input: 01-carbon_atom.02-psf_l1.inp
match ; SCF convergence ; GREPCOUNT(static/info, 'SCF converged') ; 1
Precision: 1.67e-06
match ;  Total energy        ; GREPFIELD(static/info, 'Total       =', 3) ; -146.81355602000002
match ;  Eigenvalue   [1up]  ; GREPFIELD(static/info, '1   up', 3) ; -14.466519
match ;  Occupation   [1up]  ; GREPFIELD(static/info, '1   up', 4) ; 1.0
match ;  Eigenvalue [4down]  ; GREPFIELD(static/info, '4   dn', 3) ; -3.683368
match ;  Occupation [4down]  ; GREPFIELD(static/info, '4   dn', 4) ; 0.0

#The same using double grid
Processors: 1
# double grid not working in parallel
Input: 01-carbon_atom.03-ground_state_double_grid.inp
match ; SCF convergence ; GREPCOUNT(static/info, 'SCF converged') ; 1
match ;  Total energy        ; GREPFIELD(static/info, 'Total       =', 3) ; -146.66215026
match ;  Eigenvalue   [1up]  ; GREPFIELD(static/info, '1   up', 3) ; -14.418831
match ;  Occupation   [1up]  ; GREPFIELD(static/info, '1   up', 4) ; 1.0
match ;  Eigenvalue [4down]  ; GREPFIELD(static/info, '4   dn', 3) ; -3.694716
match ;  Occupation [4down]  ; GREPFIELD(static/info, '4   dn', 4) ; 0.0

#The same but with a static electric field along the x axis
Input: 01-carbon_atom.04-static_field.inp
match ; SCF convergence ; GREPCOUNT(static/info, 'SCF converged') ; 1
match ;  Total energy        ; GREPFIELD(static/info, 'Total       =', 3) ; -146.81293144
match ;  Int[n*v_E]          ; GREPFIELD(static/info, 'Int\[n\*v\_E\]  =', 3) ; -0.00136289
match ;  Eigenvalue   [1up]  ; GREPFIELD(static/info, '1   up', 3) ; -14.467189
match ;  Occupation   [1up]  ; GREPFIELD(static/info, '1   up', 4) ; 1.0
match ;  Eigenvalue [4down]  ; GREPFIELD(static/info, '4   dn', 3) ; -3.684115
match ;  Occupation [4down]  ; GREPFIELD(static/info, '4   dn', 4) ; 0.0

Input: 01-carbon_atom.05-smear.inp
match ; SCF convergence ; GREPCOUNT(static/info, 'SCF converged') ; 1
Precision: 4.35e-07
match ;  Total energy        ; GREPFIELD(static/info, 'Total       =', 3) ; -146.741526545
match ;  Eigenvalue   [1up]  ; GREPFIELD(static/info, '1   up', 3) ; -14.461741
match ;  Occupation   [1up]  ; GREPFIELD(static/info, '1   up', 4) ; 1.0
match ;  Eigenvalue [4down]  ; GREPFIELD(static/info, '4   dn', 3) ; -3.682153
match ;  Occupation [4down]  ; GREPFIELD(static/info, '4   dn', 4) ; 0.0
