# -*- coding: utf-8 -*-
# $Id$

Test       : LOBPCG (parallel)
Programs   : octopus_mpi
TestGroups : long-run
Enabled    : No

# Depending on the surrounding, the LOBPCG routine takes different branches, which
# are checked with this test:
#   * spin-polarized.
#   * spinors,
#   * curvilinear coordinates,
# The checks are only performed with the parallel LOBPCG.

Input: 21-lobpcg.01-spin_polarized.inp

Matches ; Eigenvalue [1up] ; sed -n '/^Eigenvalues \[/{n\;n\;p\;}'                      static/info ; \s*-14.461*\d*\s*1.0000\d*
Matches ; Eigenvalue [1dn] ; sed -n '/^Eigenvalues \[/{n\;n\;n\;p\;}'                   static/info ; \s*-11.750*\d*\s*1.0000\d*
Matches ; Eigenvalue [2up] ; sed -n '/^Eigenvalues \[/{n\;n\;n\;n\;p\;}'                static/info ; \s*-6.187*\d*\s*0.6666\d*
Matches ; Eigenvalue [2dn] ; sed -n '/^Eigenvalues \[/{n\;n\;n\;n\;n\;p\;}'             static/info ; \s*-3.682*\d*\s*0.0000\d*
Matches ; Eigenvalue [3up] ; sed -n '/^Eigenvalues \[/{n\;n\;n\;n\;n\;n\;p\;}'          static/info ; \s*-6.187*\d*\s*0.6666\d*
Matches ; Eigenvalue [3dn] ; sed -n '/^Eigenvalues \[/{n\;n\;n\;n\;n\;n\;n\;p\;}'       static/info ; \s*-3.682*\d*\s*0.0000\d*
Matches ; Eigenvalue [4up] ; sed -n '/^Eigenvalues \[/{n\;n\;n\;n\;n\;n\;n\;n\;p\;}'    static/info ; \s*-6.187*\d*\s*0.6666\d*
Matches ; Eigenvalue [4dn] ; sed -n '/^Eigenvalues \[/{n\;n\;n\;n\;n\;n\;n\;n\;n\;p\;}' static/info ; \s*-3.682*\d*\s*0.0000\d*

Input: 21-lobpcg.02-spinors.inp

Matches ; Eigenvalue [1st] ; sed -n '/^Eigenvalues \[/{n\;n\;p\;}'             static/info ; \s*-14.461*\d*\s*1.00\d*\s*0.352\d*\s*0.354\d*\s*-0.001\d*
Matches ; Eigenvalue [2nd] ; sed -n '/^Eigenvalues \[/{n\;n\;n\;p\;}'          static/info ; \s*-11.750*\d*\s*1.00\d*\s*-0.352\d*\s*-0.354\d*\s*0.001\d*
Matches ; Eigenvalue [3rd] ; sed -n '/^Eigenvalues \[/{n\;n\;n\;n\;p\;}'       static/info ; \s*-6.187*\d*\s*0.67\d*\s*0.352\d*\s*0.354\d*\s*-0.001\d*
Matches ; Eigenvalue [4th] ; sed -n '/^Eigenvalues \[/{n\;n\;n\;n\;n\;p\;}'    static/info ; \s*-6.187*\d*\s*0.67\d*\s*0.352\d*\s*0.354\d*\s*-0.001\d*
Matches ; Eigenvalue [5th] ; sed -n '/^Eigenvalues \[/{n\;n\;n\;n\;n\;n\;p\;}' static/info ; \s*-6.187*\d*\s*0.67\d*\s*0.352\d*\s*0.354\d*\s*-0.001\d*

Matches ; Local Magnetic Moment [x] ; sed -n '/^Local Magnetic Moment/{n\;n\;p\;}' static/info | awk -F' ' '{print $3}' ; \s*1.410\d*
Matches ; Local Magnetic Moment [y] ; sed -n '/^Local Magnetic Moment/{n\;n\;p\;}' static/info | awk -F' ' '{print $4}' ; \s*1.417\d*
Matches ; Local Magnetic Moment [z] ; sed -n '/^Local Magnetic Moment/{n\;n\;p\;}' static/info | awk -F' ' '{print $5}' ; \s*-0.004\d*
