# -*- coding: utf-8 mode: shell-script -*-
# $Id$

Test       : 1D Asymmetric Double Well
Author     : Alberto
Date       : 10.10.07
Arch       : Linux 
Release    : 2.2.0pre1
Programs   : octopus
TestGroups : long-run
Enabled    : Yes

# The test ensures a number features of the optimal control implementation in octopus.
# It replicates some of the results given in:
# J. Werschnik and E. K. U. Gross, J. Opt. B: Quantum Semiclass. Opt 7, S300 (2005).
#
# First, we obtain the two lowest eigenstates of the asymmetric double well:
#
# V(x) = 1/64*(x)^4-1/4*(x)^2+1/256*(x)^3
#

Input: 05-adw.01-ground_state.inp
Match ; TotalEnergy ; grep -A 7 '^Energy:' ground_state_static/info ; \s*Total\s*=\s*-0.6206
Match ; 2th state  ; grep '2   --' excited_states_static/eigenvalues ; \s*-0.4638

# Now we run an OCT run identical (or almost, the numerical parameters
# are slightly different) to the one described in section 5.1.1, and
# in Fig. 2. It transfers the particle from the left well to the right
# well, by making use of the WG05 algorithm, and with a fixed fluence.
#
# It runs for only two iterations (which is enough to test that the
# implementation is working), but if it is continued it replicates
# nicely the results given in Fig. 2.

Input: 05-adw.02-filter_fixed.inp
Match ; J1 1st  iteration  ; grep ' 1  ' opt-control/convergence ; \s*-0.2129\d*\s*0.0006
Match ; J1 2nd  iteration  ; grep ' 2  ' opt-control/convergence ; \s*0.540\d*\s*0.580

# Now use filter and optimize indirect transition via 3rd excited state.
# (For the moment, disconnected)

#Input: 05-adw.03-filter_indirect.inp

# Match overlaps 
#Match ; J1 1st  iteration  ; grep ' 1  ' opt-control/convergence ; \s*0.062\d*
#Match ; J1 2nd  iteration  ; grep ' 2  ' opt-control/convergence ; \s*0.195\d*
# The run stops at iter number two; however it should continue further to see that
# the result actually converges. Apparently, however, the algorithm is unstable
# and produces different results in different machines.
